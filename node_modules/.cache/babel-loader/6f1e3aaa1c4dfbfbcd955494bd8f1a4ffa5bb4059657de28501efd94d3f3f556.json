{"ast":null,"code":"import React,{useEffect,useMemo,useRef,useState}from\"react\";import AssistantPanelHeader from\"./AssistantPanelHeader\";import{FormatDateTime}from\"../../Utils/TimeUtils\";import SummaryCard from\"../SummaryCard/SummaryCard\";import{WellnessBreakResponse}from\"../../Utils/WellnessBreakTypes\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function renderCard(index,card){const formattedTimestamp=card.timestamp?FormatDateTime(card.timestamp):\"\";console.info(\"Formatted Date: \",formattedTimestamp);return/*#__PURE__*/_jsx(SummaryCard,{content:card.content,contentRaw:card.contentRaw,timestamp:formattedTimestamp,widgetType:card.widgetType},index);}const AssistantPanel=props=>{const summariesEndRef=useRef(null);// const { grpcData } = useSelector((state: RootState) => state.VASummary);\nconst grpcData=useMemo(()=>{return{summary:{call_reason:\"Customer Inquiry\",hand_off_reason:\"Escalation to Supervisor\",details:\"*Issue with billing\\n*Requested refund\\n*Account update needed\"},interactionDateTime:\"23/Apr/2023:11:42:35\"};},[]);const[summaryCards,setSummaryCards]=useState([]);useEffect(()=>{// when the summaryCards change, scroll to the bottom\n// adding a slight delay to this as it doesn't always work on first render otherwise\nconsole.info(\"Summary Cards: \",summaryCards);setTimeout(()=>{if(summariesEndRef.current&&summaryCards.length>0){var _summariesEndRef$curr;(_summariesEndRef$curr=summariesEndRef.current)===null||_summariesEndRef$curr===void 0?void 0:_summariesEndRef$curr.scrollIntoView({behavior:\"smooth\"});}},0.1);},[summaryCards]);//#region  GRPC Data VA Summary\nuseEffect(()=>{console.info(\"GRPC Data is\",grpcData);const content=new Map();let timestamp=\"\";const header=\"Here's the virtual agent transfer summary\";let contentRaw=\"\";const summary=grpcData===null||grpcData===void 0?void 0:grpcData.summary;if(summary){console.info(\"grpc data.summary is present\",grpcData);if(summary.call_reason&&summary.call_reason!==null&&summary.call_reason!==\"\"){content.set(\"Contact Reason:\",summary.call_reason);contentRaw+=summary.call_reason;}if(summary.hand_off_reason&&summary.hand_off_reason!==null&&summary.hand_off_reason!==\"\"){content.set(\"Handoff Reason:\",summary.hand_off_reason);contentRaw+=summary.hand_off_reason;}if(summary.details&&summary.details!==null&&summary.details!==\"\"){contentRaw+=summary.details;const safeText=contentRaw.replace(/</g,\"&lt;\").replace(/>/g,\"&gt;\");content.set(\"Details:\",\"<ul style = \\\"padding-inline-start: 1.5em;\\\">\"+safeText.split(\"*\").slice(1).map(item=>`<li>${item.split(\"\\n\").slice().map(i=>`${i}<br />`).join(\"\")} </li>`).join(\"\")+\"</ul>\");}console.info(\"content is\",content);}else{console.info(\"data.summary isnt present\",grpcData);}// Combine the parts into a formatted datetime\nif(grpcData!==null&&grpcData!==void 0&&grpcData.interactionDateTime)timestamp=grpcData===null||grpcData===void 0?void 0:grpcData.interactionDateTime;console.info(\"Formatted Date: \",timestamp);if(summary!==null&&summary!==void 0&&summary.hand_off_reason||summary!==null&&summary!==void 0&&summary.details||summary!==null&&summary!==void 0&&summary.call_reason){console.info(\"Summary is available\",summary.call_reason);setSummaryCards(prevSummaryCards=>{var _contentRaw,_timestamp;return[...prevSummaryCards,{content:content!==null&&content!==void 0?content:\"\",contentRaw:(_contentRaw=contentRaw)!==null&&_contentRaw!==void 0?_contentRaw:\"\",timestamp:(_timestamp=timestamp)!==null&&_timestamp!==void 0?_timestamp:\"\",header:header!==null&&header!==void 0?header:\"\",widgetType:\"VAHSummary\",actionable:false,response:WellnessBreakResponse.NONE,agentEngaged:null,error:null}];});}else console.info(\"Summary Not available\",content);},[grpcData]);// #endregion\nreturn/*#__PURE__*/_jsx(\"div\",{style:{height:\"100%\",display:\"flex\",flexDirection:\"column\",overflow:\"auto\"},children:summaryCards.length>0?/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:\"auto\"},children:[summaryCards.map((card,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,display:\"flex\",flexDirection:\"column\"},children:[card.header&&/*#__PURE__*/_jsx(AssistantPanelHeader,{header:card.header}),/*#__PURE__*/_jsx(\"div\",{style:{paddingLeft:\"10px\",paddingBottom:\"10px\",paddingRight:\"10px\"},children:renderCard(index,card)})]},index)),/*#__PURE__*/_jsx(\"div\",{ref:summariesEndRef})]}):/*#__PURE__*/_jsx(\"span\",{style:{width:\"100%\",margin:\"20px\"},children:\"No summary available\"})});};export default AssistantPanel;","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","AssistantPanelHeader","FormatDateTime","SummaryCard","WellnessBreakResponse","jsx","_jsx","jsxs","_jsxs","renderCard","index","card","formattedTimestamp","timestamp","console","info","content","contentRaw","widgetType","AssistantPanel","props","summariesEndRef","grpcData","summary","call_reason","hand_off_reason","details","interactionDateTime","summaryCards","setSummaryCards","setTimeout","current","length","_summariesEndRef$curr","scrollIntoView","behavior","Map","header","set","safeText","replace","split","slice","map","item","i","join","prevSummaryCards","_contentRaw","_timestamp","actionable","response","NONE","agentEngaged","error","style","height","display","flexDirection","overflow","children","marginTop","flex","paddingLeft","paddingBottom","paddingRight","ref","width","margin"],"sources":["/Users/ratbalas/Documents/Projects/temp/ai-assistant.github.io/src/components/AssistantPanel/AssistantPanel.tsx"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from \"react\";\nimport AssistantPanelHeader from \"./AssistantPanelHeader\";\nimport { FormatDateTime } from \"../../Utils/TimeUtils\";\nimport SummaryCard from \"../SummaryCard/SummaryCard\";\nimport { WellnessBreakError, WellnessBreakResponse } from \"../../Utils/WellnessBreakTypes\";\nimport { useSelector } from \"react-redux\";\nimport { RootState } from \"../../Store\";\n\ninterface SummaryCardMapping {\n  content: Map<string, string>;\n  contentRaw: string;\n  timestamp: string;\n  header: string;\n  widgetType: string;\n  actionable: boolean;\n  response: WellnessBreakResponse;\n  agentEngaged: boolean | null;\n  error: WellnessBreakError | null;\n}\n\nfunction renderCard(index: number, card: SummaryCardMapping): JSX.Element {\n  const formattedTimestamp = card.timestamp ? FormatDateTime(card.timestamp) : \"\";\n  console.info(\"Formatted Date: \", formattedTimestamp);\n\n  return <SummaryCard key={index} content={card.content} contentRaw={card.contentRaw} timestamp={formattedTimestamp} widgetType={card.widgetType} />;\n}\n\nconst AssistantPanel = (props: any): any => {\n  const summariesEndRef = useRef<null | HTMLDivElement>(null);\n  // const { grpcData } = useSelector((state: RootState) => state.VASummary);\n  const grpcData = useMemo(() => {\n    return {\n      summary: {\n        call_reason: \"Customer Inquiry\",\n        hand_off_reason: \"Escalation to Supervisor\",\n        details: \"*Issue with billing\\n*Requested refund\\n*Account update needed\"\n      },\n      interactionDateTime: \"23/Apr/2023:11:42:35\"\n    };\n  }, []);\n\n  const [summaryCards, setSummaryCards] = useState<SummaryCardMapping[]>([]);\n\n  useEffect(() => {\n    // when the summaryCards change, scroll to the bottom\n    // adding a slight delay to this as it doesn't always work on first render otherwise\n    console.info(\"Summary Cards: \", summaryCards);\n    setTimeout(() => {\n      if (summariesEndRef.current && summaryCards.length > 0) {\n        summariesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n      }\n    }, 0.1);\n  }, [summaryCards]);\n\n  //#region  GRPC Data VA Summary\n  useEffect(() => {\n    console.info(\"GRPC Data is\", grpcData);\n\n    const content = new Map<string, string>();\n    let timestamp = \"\";\n    const header = \"Here's the virtual agent transfer summary\";\n    let contentRaw = \"\";\n    const summary = grpcData?.summary;\n\n    if (summary) {\n      console.info(\"grpc data.summary is present\", grpcData);\n\n      if (summary.call_reason && summary.call_reason !== null && summary.call_reason !== \"\") {\n        content.set(\"Contact Reason:\", summary.call_reason);\n        contentRaw += summary.call_reason;\n      }\n      if (summary.hand_off_reason && summary.hand_off_reason !== null && summary.hand_off_reason !== \"\") {\n        content.set(\"Handoff Reason:\", summary.hand_off_reason);\n        contentRaw += summary.hand_off_reason;\n      }\n\n      if (summary.details && summary.details !== null && summary.details !== \"\") {\n        contentRaw += summary.details;\n        const safeText = contentRaw.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\n        content.set(\n          \"Details:\",\n          \"<ul style = \\\"padding-inline-start: 1.5em;\\\">\" +\n            safeText\n              .split(\"*\")\n              .slice(1)\n              .map(\n                (item) =>\n                  `<li>${item\n                    .split(\"\\n\")\n                    .slice()\n                    .map((i) => `${i}<br />`)\n                    .join(\"\")} </li>`\n              )\n              .join(\"\") +\n            \"</ul>\"\n        );\n      }\n      console.info(\"content is\", content);\n    } else {\n      console.info(\"data.summary isnt present\", grpcData);\n    }\n\n    // Combine the parts into a formatted datetime\n    if (grpcData?.interactionDateTime) timestamp = grpcData?.interactionDateTime;\n\n    console.info(\"Formatted Date: \", timestamp);\n\n    if (summary?.hand_off_reason || summary?.details || summary?.call_reason) {\n      console.info(\"Summary is available\", summary.call_reason);\n      setSummaryCards((prevSummaryCards) => [\n        ...prevSummaryCards,\n        {\n          content: content ?? \"\",\n          contentRaw: contentRaw ?? \"\",\n          timestamp: timestamp ?? \"\",\n          header: header ?? \"\",\n          widgetType: \"VAHSummary\",\n          actionable: false,\n          response: WellnessBreakResponse.NONE,\n          agentEngaged: null,\n          error: null\n        }\n      ]);\n    } else console.info(\"Summary Not available\", content);\n  }, [grpcData]);\n  // #endregion\n\n  return (\n    <div\n      style={{\n        height: \"100%\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        overflow: \"auto\"\n      }}\n    >\n      {summaryCards.length > 0 ? (\n        <div\n          style={{\n            marginTop: \"auto\"\n          }}\n        >\n          {summaryCards.map((card, index) => (\n            <div key={index} style={{ flex: 1, display: \"flex\", flexDirection: \"column\" }}>\n\n              {card.header && <AssistantPanelHeader header={card.header} />}\n\n              <div\n                style={{\n                  paddingLeft: \"10px\",\n                  paddingBottom: \"10px\",\n                  paddingRight: \"10px\"\n                }}\n              >\n                {renderCard(index, card)}\n              </div>\n            </div>\n          ))}\n          <div ref={summariesEndRef}></div>\n        </div>\n      ) : (\n        <span style={{ width: \"100%\", margin: \"20px\" }}>No summary available</span>\n      )}\n    </div>\n  );\n};\n\nexport default AssistantPanel;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}